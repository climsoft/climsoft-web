<app-dialog [(open)]="open" [title]="'Search Stations'" [okButtonLabel]="'Ok'" (okClick)="onOkClick()">
    <div *ngIf="open" class="card border-0">

        <!-- tab header -->
        <div class="card-header d-flex">
            <ul class="nav nav-tabs card-header-tabs">
                <li class="nav-item">
                    <button class="nav-link" [class.active]="activeTab === 'history'"
                        (click)="onTabClick('history')">History</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link active" [class.active]="activeTab === 'new'"
                        (click)="onTabClick('new')">New</button>
                </li>
            </ul>
        </div>

        <!-- selected tab contents -->
        <div class="card-body p-0">
            <div class="d-flex align-items-center">
                <div *ngIf="activeTab === 'history'" class="d-flex align-items-center">
                    <div *ngIf="!previousSearches || previousSearches.length===0" class="mt-2">
                        No saved searches
                    </div>
                    <div *ngIf="previousSearches && previousSearches.length>0">
                        <ul class="list-group rounded-0 list-group-flush p-0 search-contents">
                            <li class="list-group-item list-group-item-action px-0 d-flex justify-content-between cursor-pointer"
                                *ngFor="let item of previousSearches"
                                [class.list-group-item-primary]="item.name === searchName"
                                (click)="onPreviousSearchSelected(item)">

                                <div class="me-2 d-flex">
                                    <div class="me-1">
                                        <i class="bi bi-cursor"></i>
                                    </div>
                                    <div>
                                        {{ item.name }}
                                    </div>
                                </div>

                                <div class="d-flex">
                                    <button type="button" class="btn btn-outline-secondary btn-sm me-2"
                                        (click)="onEditPreviousSearch(item)">
                                        Edit
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm"
                                        (click)="onDeletePreviousSearch(item)">
                                        Delete
                                    </button>
                                </div>

                            </li>
                        </ul>
                    </div>

                </div>

                <div *ngIf="activeTab === 'new'" class="mt-2">
                    <div>
                        <div>Search By:</div>
                        <div>
                            <app-radio-buttons-input [inline]="true" [asButtons]="true" [groupName]="'searchOptions'"
                                [groupItems]="[ 
                                    { label:searchByOptionEnum.ID_NAME ,checked: searchBy === searchByOptionEnum.ID_NAME }, 
                                    { label:searchByOptionEnum.REGION, checked : searchBy === searchByOptionEnum.REGION},
                                    { label:searchByOptionEnum.ORGANISATION, checked : searchBy === searchByOptionEnum.ORGANISATION},
                                    { label:searchByOptionEnum.NETWORK_AFFILIATION, checked : searchBy === searchByOptionEnum.NETWORK_AFFILIATION},
                                    { label:searchByOptionEnum.STATUS, checked : searchBy === searchByOptionEnum.STATUS},
                                    { label:searchByOptionEnum.PROCESSING, checked : searchBy === searchByOptionEnum.PROCESSING},
                                    { label:searchByOptionEnum.ENVIRONMENT, checked : searchBy === searchByOptionEnum.ENVIRONMENT},
                                    { label:searchByOptionEnum.FOCUS, checked : searchBy === searchByOptionEnum.FOCUS},
                                    ]" (checkedValueChange)="onSearchOptionChange($event)" />
                        </div>
                        <div class="mt-2">
                            <div class="flex-grow-1">
                                <app-text-input [id]="'station_search_input'" [placeholder]="'Search'"
                                    (valueChange)="onSearchInput($event)" />
                            </div>
                        </div>
                    </div>

                    <hr />

                    <div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex justify-content-start align-items-center">
                                <button type="button" class="btn btn-outline-secondary btn-sm"
                                    (click)="onSelectionOptionClick(selectionOptionTypeEnum.SORT_SELECTED)">
                                    Sort Selected
                                </button>
                                <button *ngIf="searchBy === searchByOptionEnum.ID_NAME" type="button"
                                    class="btn btn-outline-secondary btn-sm ms-2"
                                    (click)="onSelectionOptionClick(selectionOptionTypeEnum.SORT_BY_ID)">
                                    Sort By ID
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm ms-2"
                                    (click)="onSelectionOptionClick(selectionOptionTypeEnum.SORT_BY_NAME)">
                                    Sort By Name
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm ms-2"
                                    (click)="onSelectionOptionClick(selectionOptionTypeEnum.SELECT_ALL)">
                                    Select All
                                </button>
                                <button *ngIf="searchBy === 'Id or Name'" type="button"
                                    class="btn btn-outline-secondary btn-sm ms-2"
                                    (click)="onSelectionOptionClick(selectionOptionTypeEnum.DESELECT_ALL)">
                                    Deselect All
                                </button>
                            </div>

                            <div class="mx-2 fw-bold" [class.text-success]="searchedIds.length > 0">
                                [{{ searchedIds.length | number:'1.0-0' }}]
                            </div>
                        </div>

                        <div class="mt-2">
                            <div *ngIf="searchBy ==='Id or Name'">
                                <app-station-id-name-search [stations]="stations" [inputSearchedIds]="searchedIds"
                                    [searchValue]="searchValue" [selectionOption]="selectionOption"
                                    (searchedIdsChange)="setSearchedIds($event)" />
                            </div>
                            <div *ngIf="searchBy === 'Region'">
                                <app-station-regions-search [stations]="stations" [searchValue]="searchValue"
                                    [selectionOption]="selectionOption" (searchedIdsChange)="setSearchedIds($event)" />
                            </div>
                            <div *ngIf="searchBy === 'Organisation'">
                                <app-station-organisations-search [stations]="stations" [searchValue]="searchValue"
                                    [selectionOption]="selectionOption" (searchedIdsChange)="setSearchedIds($event)" />
                            </div>
                            <div *ngIf="searchBy === 'Network Affiliation'">
                                <app-station-network-affiliations-search [stations]="stations"
                                    [searchValue]="searchValue" [selectionOption]="selectionOption"
                                    (searchedIdsChange)="setSearchedIds($event)" />
                            </div>
                            <div *ngIf="searchBy === 'Status'">
                                <app-station-status-search [stations]="stations" [searchValue]="searchValue"
                                    [selectionOption]="selectionOption" (searchedIdsChange)="setSearchedIds($event)" />
                            </div>
                            <div *ngIf="searchBy === 'Processing'">
                                <app-station-processing-method-search [stations]="stations" [searchValue]="searchValue"
                                    [selectionOption]="selectionOption" (searchedIdsChange)="setSearchedIds($event)" />
                            </div>
                            <div *ngIf="searchBy === 'Environment'">
                                <app-station-environments-search [stations]="stations" [searchValue]="searchValue"
                                    [selectionOption]="selectionOption" (searchedIdsChange)="setSearchedIds($event)" />
                            </div>
                            <div *ngIf="searchBy === 'Focus'">
                                <app-station-focuses-search [stations]="stations" [searchValue]="searchValue"
                                    [selectionOption]="selectionOption" (searchedIdsChange)="setSearchedIds($event)" />
                            </div>
                        </div>

                    </div>

                    <hr />

                    <div>
                        <app-check-box-input [id]="'save_station_search'" [label]="'Save Search'"
                            [(value)]="saveSearch" />
                        <div *ngIf="saveSearch" class="ms-2">
                            <app-text-input [id]="'station_search_save'" [(value)]="searchName" />
                        </div>
                    </div>

                </div>


                <div *ngIf="displayMapviewer" class="ms-1" style="min-width: 430px;">
                    <app-view-stations-geo-map [mapHeight]="'430px'" [displayStats]="false"
                        [stationIds]="searchedIds" />
                </div>
            </div>


        </div>

    </div>

</app-dialog>