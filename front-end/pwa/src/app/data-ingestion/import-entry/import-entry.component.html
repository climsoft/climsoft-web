<ng-container *ngIf="open && viewSource">
  <app-dialog [(open)]="open" [title]="title" [displayOkOption]="showConfirmImport" [okButtonLabel]="'Confirm Import'"
    [closeOnOkClick]="false" (okClick)="onConfirmImport()" (cancelClick)="closeDialog()">

    <div class="card border-0">

        <!-- station and file selction -->
      <div class="card-header d-flex px-1 py-0 flex-column">
        <div *ngIf="showStationSelection" class="mt-1">
          <app-station-selector-single [label]="'Station'" [includeOnlyIds]="onlyIncludeStationIds"
            [(selectedId)]="selectedStationId" />
        </div>
        <div class="mt-1 mb-1">
          <app-file-input [label]="'File to Upload'" [buttonLabel]="'Upload File'" [disabled]="disableUpload"
            (fileSelected)="onFileSelected($event)" />
        </div>
      </div>

      <div class="card-body px-1">

        <!-- Status message -->
        <div *ngIf="importMessage" class="alert py-2 mb-2"
          [ngClass]="{ 'alert-danger': importStage === ImportStage.ERROR, 'alert-success': importStage === ImportStage.SUCCESS, 'alert-info': importStage === ImportStage.UPLOADING || importStage === ImportStage.PREVIEWING || importStage === ImportStage.IMPORTING }">
          <div class="d-flex align-items-center" style="gap: 8px;">
            <div
              *ngIf="importStage === ImportStage.UPLOADING || importStage === ImportStage.PREVIEWING || importStage === ImportStage.IMPORTING"
              class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            {{ importMessage }}
          </div>
        </div>

        <!-- Expected Format (Sample File) -->
        <div class="card border-info mb-3">
          <div class="card-header bg-info bg-opacity-10 border-info py-2">
            <strong>Expected Format</strong>
            <small class="text-muted d-block">Reference data from the import specification. Use this to verify your file matches the expected structure.</small>
          </div>
          <div class="card-body py-2 px-2">

            <div *ngIf="sampleSkippedRows.length > 0" class="mb-2">
              <app-import-preview-table [title]="'Skipped Rows'" [columns]="sampleColumns" [rows]="sampleSkippedRows"
                [hasFile]="true" [maxHeight]="'15vh'" />
            </div>

            <app-import-preview-table [title]="'Sample Data'" [columns]="sampleColumns"
              [rows]="sampleRows" [totalRowCount]="sampleTotalRowCount" [loading]="sampleLoading"
              [hasFile]="sampleHasFile" [noFileMessage]="'No sample file available for this import specification'"
              [maxHeight]="'15vh'" />

          </div>
        </div>

        <!-- Your Upload -->
        <div class="card mb-3">
          <div class="card-header py-2">
            <strong>Your Upload</strong>
            <small class="text-muted d-block">Preview of the file you uploaded. Compare with the expected format above.</small>
          </div>
          <div class="card-body py-2 px-2">

            <app-import-preview-table [title]="'Raw Data'" [columns]="rawUploadColumns"
              [rows]="rawUploadRows" [totalRowCount]="rawUploadTotalRowCount" [hasFile]="rawUploadHasFile"
              [noFileMessage]="'Upload a file to see the raw data'" [maxHeight]="'15vh'" />

            <div class="mt-2">
              <app-import-preview-table [title]="'Transformed Data'" [columns]="uploadColumns"
                [rows]="uploadRows" [totalRowCount]="uploadTotalRowCount" [rowsDropped]="uploadRowsDropped"
                [warnings]="uploadWarnings" [error]="uploadError" [loading]="uploadLoading" [hasFile]="uploadHasFile"
                [noFileMessage]="'Upload a file to see a preview of the transformed data before importing'"
                [maxHeight]="'15vh'" />
            </div>

          </div>
        </div>


      </div>
    </div>

  </app-dialog>
</ng-container>