<div *ngIf="viewSource" class="card border-0">
  <div class="card-header d-flex px-1 py-0 flex-column">
    <div *ngIf="showStationSelection" class="mt-1">
      <app-station-selector-single [label]="'Station'" [includeOnlyIds]="onlyIncludeStationIds"
        [(selectedId)]="selectedStationId" />
    </div>
    <div class="mt-1 mb-1 d-flex justify-content-between align-items-center">
      <div>
        File to Upload
      </div>
      <div>
        <input #fileUpload type="file" style="display: none;" [accept]="'.csv,.dat,.tsv,.txt'"
          (change)="onFileSelected($event)">
        <button type="button" class="btn btn-outline-secondary btn-sm" [disabled]="disableUpload"
          (click)="fileUpload.click()">
          Upload File
        </button>
      </div>
    </div>
  </div>

  <div class="card-body">
    <div class="d-flex flex-column align-items-center justify-content-center"
      style="min-height:300px; background-color:#e0f7fa; border-radius: 8px; padding: 24px;">

      <!-- File Name Display (when file is selected) -->
      <div *ngIf="selectedFileName && uploadStage !== UploadStage.IDLE" class="mb-3">
        <span class="badge bg-secondary" style="font-size: 0.9rem; padding: 8px 16px;">
          ğŸ“„ {{ selectedFileName }}
        </span>
      </div>

      <!-- Timer Display (during upload/processing) -->
      <div
        *ngIf="uploadStage === UploadStage.UPLOADING || uploadStage === UploadStage.PROCESSING || uploadStage === UploadStage.IMPORTING"
        class="mb-3">
        <div class="text-center">
          <div style="font-size: 2.5rem; font-weight: 600; color: #0277bd; font-family: monospace;">
            {{ elapsedTime }}
          </div>
          <div style="font-size: 0.85rem; color: #666; margin-top: -4px;">
            elapsed time
          </div>
        </div>
      </div>

      <!-- Completion Time Display (after success/error) -->
      <div *ngIf="(uploadStage === UploadStage.SUCCESS || uploadStage === UploadStage.ERROR) && elapsedTime !== '00:00'"
        class="mb-3">
        <div class="text-center">
          <span class="badge" [ngClass]="uploadStage === UploadStage.SUCCESS ? 'bg-success' : 'bg-danger'"
            style="font-size: 1rem; padding: 6px 12px;">
            â±ï¸ Completed in {{ elapsedTime }}
          </span>
        </div>
      </div>

      <!-- Status Message -->
      <div class="text-center mb-3" [class.text-danger]="uploadError"
        [class.text-success]="uploadStage === UploadStage.SUCCESS" style="font-size: 1.1rem; font-weight: 500;">
        {{ uploadMessage }}
      </div>

      <!-- Progress Bar (during active upload/processing) -->
      <div class="px-4 w-100"
        *ngIf="uploadStage === UploadStage.UPLOADING || uploadStage === UploadStage.PROCESSING || uploadStage === UploadStage.IMPORTING">
        <div class="progress" style="height: 8px;">
          <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" style="width: 100%"></div>
        </div>
      </div>

      <!-- Stage Indicator -->
      <div *ngIf="uploadStage !== UploadStage.IDLE" class="mt-3">
        <div class="d-flex justify-content-center align-items-center"
          style="gap: 8px; font-size: 0.85rem; color: #666;">
          <span [class.fw-bold]="uploadStage === UploadStage.UPLOADING"
            [class.text-primary]="uploadStage === UploadStage.UPLOADING">
            ğŸ“¤ Upload
          </span>
          <span>â†’</span>
          <span [class.fw-bold]="uploadStage === UploadStage.PROCESSING"
            [class.text-primary]="uploadStage === UploadStage.PROCESSING">
            âš™ï¸ Process
          </span>
          <span>â†’</span>
          <span [class.fw-bold]="uploadStage === UploadStage.IMPORTING"
            [class.text-primary]="uploadStage === UploadStage.IMPORTING">
            ğŸ’¾ Import
          </span>
          <span>â†’</span>
          <span [class.fw-bold]="uploadStage === UploadStage.SUCCESS || uploadStage === UploadStage.ERROR"
            [class.text-success]="uploadStage === UploadStage.SUCCESS"
            [class.text-danger]="uploadStage === UploadStage.ERROR">
            {{
            uploadStage === UploadStage.SUCCESS ? 'âœ… Done' : uploadStage === UploadStage.ERROR ? 'âŒ Error' : 'â³ Pending'
            }}
          </span>
        </div>
      </div>

    </div>
  </div>
</div>