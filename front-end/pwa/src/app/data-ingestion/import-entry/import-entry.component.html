<ng-container *ngIf="open && viewSource">
  <app-dialog [(open)]="open" [title]="title" [displayOkOption]="showConfirmImport" [okButtonLabel]="'Confirm Import'" (okClick)="onConfirmImport()"
    (cancelClick)="closeDialog()">

    <div class="card border-0">
      <div class="card-header d-flex px-1 py-0 flex-column">
        <div *ngIf="showStationSelection" class="mt-1">
          <app-station-selector-single [label]="'Station'" [includeOnlyIds]="onlyIncludeStationIds"
            [(selectedId)]="selectedStationId" />
        </div>
        <div class="mt-1 mb-1 d-flex justify-content-between align-items-center">
          <div>
            File to Upload
          </div>
          <div class="d-flex align-items-center" style="gap: 8px;">
            <input #fileUpload type="file" style="display: none;" [accept]="'.csv,.dat,.tsv,.txt'"
              (change)="onFileSelected($event)">
            <button type="button" class="btn btn-outline-secondary btn-sm" [disabled]="disableUpload"
              (click)="fileUpload.click()">
              Upload File
            </button>
          </div>
        </div>
      </div>

      <div class="card-body px-1">

        <!-- Status message -->
        <div *ngIf="importMessage" class="alert py-2 mb-2"
          [ngClass]="{ 'alert-danger': importStage === ImportStage.ERROR, 'alert-success': importStage === ImportStage.SUCCESS, 'alert-info': importStage === ImportStage.UPLOADING || importStage === ImportStage.PREVIEWING || importStage === ImportStage.IMPORTING }">
          <div class="d-flex align-items-center" style="gap: 8px;">
            <div
              *ngIf="importStage === ImportStage.UPLOADING || importStage === ImportStage.PREVIEWING || importStage === ImportStage.IMPORTING"
              class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            {{ importMessage }}
          </div>
        </div>

        <!-- Sample file previews -->
        <div>

          <!-- Skipped rows from sample file -->
          <div *ngIf="sampleSkippedRows.length > 0" class="mt-2">
            <app-import-preview-table [title]="'Skipped Rows'" [columns]="sampleColumns" [rows]="sampleSkippedRows"
              [hasFile]="true" [maxHeight]="'15vh'" />
          </div>

          <!-- Data preview from sample file -->
          <app-import-preview-table [title]="'Sample File (from specification)'" [columns]="sampleColumns"
            [rows]="sampleRows" [totalRowCount]="sampleTotalRowCount" [loading]="sampleLoading"
            [hasFile]="sampleHasFile" [noFileMessage]="'No sample file available for this import specification'"
            [maxHeight]="'15vh'" />

        </div>


        <!-- Uploaded File Previews -->
        <div>
          <!-- Raw upload file preview (before transformation) -->
          <div class="mt-3">
            <app-import-preview-table [title]="'Uploaded File Preview (Raw)'" [columns]="rawUploadColumns"
              [rows]="rawUploadRows" [totalRowCount]="rawUploadTotalRowCount" [hasFile]="rawUploadHasFile"
              [noFileMessage]="'Upload a file to see the raw data'" [maxHeight]="'15vh'" />
          </div>

          <!-- Upload file preview (transformed data) -->
          <div class="mt-3">
            <app-import-preview-table [title]="'Uploaded File Preview (Transformed)'" [columns]="uploadColumns"
              [rows]="uploadRows" [totalRowCount]="uploadTotalRowCount" [rowsDropped]="uploadRowsDropped"
              [warnings]="uploadWarnings" [error]="uploadError" [loading]="uploadLoading" [hasFile]="uploadHasFile"
              [noFileMessage]="'Upload a file to see a preview of the transformed data before importing'"
              [maxHeight]="'15vh'" />
          </div>
        </div>


      </div>
    </div>

  </app-dialog>
</ng-container>